<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.iu.s5.member.MemberDAO">
	
	<sql id="search">
		like '%'||#{search}||'%' 
	</sql>

	<select id="memberCount" resultType="java.lang.Long"
		parameterType="Pager">
		select count(id) from member
		<where>
			<if test="kind == 'id'">
				id
				<include refid="search"></include>
			</if>

			<if test="kind == 'na'">
				name
				<include refid="search"></include>
			</if>

			<if test="kind == 'ph'">
				phone
				<include refid="search"></include>
			</if>
			
			<if test="kind =='em'">
				email
				<include refid="search"></include>
			</if>

		</where>
	</select>

	<select id="memberList" resultType="MemberVO" parameterType="Pager">
		select * from 
			(select N.*,rownum R from 
				(select * from member where
				<choose>
					<when test="kind =='id'">
						id
					</when>
					<when test="kind =='na'">
						name
					</when>
					<when test="kind =='ph'">
						phone
					</when>
					<otherwise>
						email
					</otherwise>
				</choose>
				<include refid="search"></include>) N)
		where R between #{startRow} and #{lastRow}

	</select>

	<insert id="memberJoin"
		parameterType="MemberVO">
		insert into member
		values(#{id},#{password},#{name},#{phone},#{email},#{age})
	</insert>
	
	<select id="memberLogin" parameterType="MemberVO" resultType="MemberVO">
		select * from member where id=#{id} and password=#{password}
	</select>
	
	<select id="memberMypage" parameterType="MemberVO" resultType="MemberVO">
		select * from member where id=#{id}
	</select>
	
	<update id="memberUpdate" parameterType="MemberVO">
		update member set name=#{name}, phone=#{phone}, email=#{email}, age=#{age} where id=#{id}
	</update>
	
	<delete id="memberDelete" parameterType="MemberVO">
		delete member where id=#{id}
	</delete>

</mapper>